<header class="project-header">
  <h1 class="project-title"><%= current_instance.title %></h1>

  <div class="project-metadata">
    <div class="metadata-grid">

      <!-- Owner -->
      <div class="metadata-item owner-metadata">
        <span class="metadata-label"><%= image_tag("person.svg") %> Owner</span>
        <div class="metadata-value">
          <% if owner.is_a?(User) %>
            <p class="owner-row">
              <span class="user-badge"><%= owner.username[0].upcase %></span>
              <%= owner.username %>
            </p>
          <% else %>
            <% project.owner.users.each do |user| %>
              <p class="owner-row">
                <span class="user-badge"><%= user.username[0].upcase %></span>
                <%= user.username %>
              </p>
            <% end %>
          <% end %>
        </div>
      </div>

      <!-- Group Name (only if group project) -->
      <% if project.owner.is_a?(ProjectGroup) %>
        <div class="metadata-item">
          <span class="metadata-label"><%= image_tag("group.svg") %> Group Name</span>
          <span class="metadata-value">
            <%= project.owner.group_name %>
          </span>
        </div>
      <% end %>

      <!-- Supervisor -->
      <div class="metadata-item">
        <span class="metadata-label"><%= image_tag("person.svg") %> Supervisor</span>
        <span class="metadata-value">
          <%= @current_instance.supervisor.username %>
        </span>
      </div>

      <!-- Type -->
      <div class="metadata-item">
        <span class="metadata-label"><%= image_tag("person.svg") %> Type</span>
        <span class="metadata-value">
            <p>Project</p>
        </span>
      </div>

      <!-- Status -->
      <div class="metadata-item">
        <span class="metadata-label"><%= image_tag("status.svg") %> Status</span>
        <div class="metadata-value">
          <% if current_user == @project.supervisor && current_version== latest_version %>
            <div class="status-control">
              <%= form_with url: change_status_course_project_path(@course, @project), method: :patch, local: true, class: "status-change-form" do |f| %>
                <% if @current_instance.status == "pending" %>
                  <% statuses = Project.statuses.keys.without("not_submitted") %>
                <% else %>
                  <% statuses = Project.statuses.keys.without("not_submitted", "pending") %>
                <% end %>
                <%= f.select :status, options_for_select(statuses.map { |s| [s.humanize, s] }, current_instance.status), {}, class: "status-select status-#{@project.status}" %>
                <%= f.button type: "submit", class: "status-save-btn", title: "Save status" do %>
                  <%= image_tag("check.svg", width: 16, height: 16, alt: "Save") %>
                <% end %>
              <% end %>
            </div>
          <% else %>
            <span class="metadata-value status-<%= current_instance.status %>">
              <%= current_instance.status.humanize %>
            </span>
          <% end %>
        </div>
      </div>

      <!-- Version Info with Arrows -->
      <div class="metadata-item version-info">
        <span 
          class="metadata-label"><%= image_tag("version.svg") %> Version 
          <% if current_version != latest_version %>
            <em class="version-note">(viewing older version)</em>
          <% end %>
        </span>

        <div class="metadata-value version-navigation">
          <% # Back arrow: older version (lower index) %>
          <% if current_version > 1 %>
            <%= link_to course_project_path(@course, project, version: current_version - 1), class: "version-btn back-arrow" do %>
              <%= image_tag("arrow_back.svg", class:"back-arrow") %>
            <% end %>
          <% else %>
            <span class="version-btn back-arrow disabled">
              <%= image_tag("arrow_back.svg", class:"back-arrow") %>
            </span>
          <% end %>

          <span class="version-text"><%= current_version %> of <%= instances.size %></span>

          <% # Next arrow: newer version (higher index) %>
          <% if current_version < instances.size %>
            <%= link_to course_project_path(@course, project, version: current_version + 1), class: "version-btn next-arrow" do %>
              <%= image_tag("arrow_forward.svg", class:"foward-arrow") %>
            <% end %>
          <% else %>
            <span class="version-btn next-arrow disabled">
              <%= image_tag("arrow_forward.svg", class:"foward-arrow") %>
            </span>
          <% end %>
        </div>
      </div>

    </div>
  </div>
</header>
