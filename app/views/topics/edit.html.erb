<h1>Edit Topic</h1>

<%= form_with(model: [@course, @project], url: course_topic_path(@course, @project), method: :patch) do %>
  <% @template_fields.each do |field| %>
    <div class="field">
      <%= label_tag "fields_#{field.id}", field.label, title: field.hint %>

      <% existing_value = @instance.project_instance_fields.find { |f| f.project_template_field_id == field.id }&.value %>

      <% case field.field_type %>
      <% when "shorttext" %>
        <%= text_field_tag "fields[#{field.id}]", existing_value, class: "form-control", placeholder: field.hint, required: true %>
      <% when "textarea" %>
        <%= text_area_tag "fields[#{field.id}]", existing_value, class: "form-control", placeholder: field.hint, required: true %>
      <% when "dropdown" %>
        <%= select_tag "fields[#{field.id}]", options_for_select(field.options, existing_value), class: "form-control", placeholder: field.hint, required: true %>
      <% when "radio" %>
        <% field.options.split(',').each_with_index do |option, idx| %>
          <%= radio_button_tag "fields[#{field.id}]", option, false, id: "field_#{field.id}_#{idx}", required: true %>
          <%= label_tag "field_#{field.id}_#{idx}", option.strip %>
      <% end %>
      <% else %>
        <%= text_field_tag "fields[#{field.id}]", existing_value, class: "form-control" %>
      <% end %>
    </div>
  <% end %>

  <%= submit_tag "Update Topic", class: "btn btn-primary" %>
<% end %>

  <p>
  <%= link_to "Back to Topics", course_path(@course)%>
</p>