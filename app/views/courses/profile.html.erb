<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "lecturers"%>
  <%= stylesheet_link_tag "tailwind", "new_tailwind" %>
<% end %>
<% participant_name = @participant_type == 'group' ? @group.group_name : @student.username %>
<% content_for :breadcrumbs do %>
  <%= link_to "Dashboard",
      root_path, 
      class: "text-gray-500 hover:text-gray-900 font-medium transition-colors no-underline" %>
  <span class="mx-3 text-gray-400">&nbsp;>&nbsp;</span>

  <%= link_to @course.course_name, 
      course_path(@course), 
      class: "text-gray-500 hover:text-gray-900 font-medium transition-colors no-underline" %>
  <span class="mx-3 text-gray-400">&nbsp;>&nbsp;</span>

  <span class="text-gray-900 font-medium truncate">
    <%= participant_name %>
  </span>
<% end %>
<% content_for :title do %>
  <% if @participant_type == 'group' %>
    <%= @group.group_name %> - Group Profile | ProPro
  <% else %>
    <%= @student.username %> - Student Profile | ProPro
  <% end %>
<% end %>

<% if @participant_type == 'group' %>
  <% @project = group_project_for(@group, @course) %>
  <% @status = group_status(@group, @course) %>
<% else %>
  <% @project = student_project_for(@student, @course) %>
  <% @status = student_status(@student, @course) %>
<% end %>
<% @latest_instance = @project&.project_instances&.order(:version)&.last %>
<% @supervisor = @project&.supervisor if @project %>

<% content_for :sidebar do %>
  <div
    class="
      h-[calc(100vh-70px)] z-[20] sticky top-[70px] left-0 
      bg-[#f8f9fa] border-r border-gray-200
      transition-all duration-300
      overflow-hidden w-0 px-0 opacity-0
    "
    data-sidebar-target="container"
  >
    <div class="p-4 space-y-1 w-64 font-medium text-sm text-gray-600">
      
      <a 
        href="#title" 
        class="block px-3 py-2 rounded-md hover:bg-gray-200 hover:text-gray-900 transition-colors"
      >
        Title
      </a>

      <a 
        href="#profile-information" 
        class="block px-3 py-2 rounded-md hover:bg-gray-200 hover:text-gray-900 transition-colors"
      >
        Profile Information
      </a>

      <% if @project.present? %>
        <a 
          href="#current-project" 
          class="block px-3 py-2 rounded-md hover:bg-gray-200 hover:text-gray-900 transition-colors"
        >
          Current Project
        </a>
      <% end %>

    </div>
  </div>
<% end %>

<main class="pt-0 mt-0">
  <div class="lecturer-layout">
    <section class="lecturer-content">
      <header class="lecturer-header">
        <div class="lecturer-title" id="title">
          <span class="lecturer-title-text">
            <% if @participant_type == 'group' %>
              View Group
            <% else %>
              View Student
            <% end %>
          </span>
          <div class="title-line"></div>
        </div>
        <div class="lecturer-name-row">
          <% if @participant_type == 'student' %>
            <div class="lecturer-badge"><%= @student.username[0].upcase %></div>
            <h1 class="lecturer-name"><%= @student.username %></h1>
          <% else %>
            <h1 class="lecturer-name"><%= @group.group_name %></h1>
          <% end %>
        </div>
        
        <div class="lecturer-info" id="profile-information">
          <h2 class="lecturer-subtitle">Profile Information</h2>
          <div class="lecturer-line"></div>
          
          <% if @participant_type == 'group' %>
            <!-- Group Information -->
            <div class="info-item">
              <span class="info-label">Group Name</span>
              <span class="info-value"><%= @group.group_name %></span>
            </div>
            <div class="info-item">
              <span class="info-label">Members</span>
              <div class="info-value members-list">
                <% @members.each_with_index do |member, index| %>
                  <span class="member-info">
                    <div class="profile-container">
                      <div class="profile-avatar"><%= member.user.username.first.upcase %></div>
                      <strong><%= member.user.username %></strong>
                    </div>
                    <% if member.user.student_id.present? %>
                      STUDENT ID: <%= member.user.student_id %>
                    <% end %>
                    <em><%= member.user.email_address %></em>
                  </span>
                <% end %>
              </span>
            </div>
            <div class="info-item">
              <span class="info-label">Project Status</span>
              <span class="info-value">
                <% status_display = @status || 'not_submitted' %>
                <span class="status-badge <%= status_display.downcase.gsub('_', '-') %>">
                  <div class="status-indicator <%= status_display.downcase.gsub('_', '-') %>"></div>
                  <span><%= status_display.humanize %></span>
                </span>
              </span>
            </div>
            <% if @supervisor.present? %>
              <div class="info-item">
                <span class="info-label">Supervisor</span>
                <div class="profile-container-lecturer">
                  <div class="profile-avatar"><%= @supervisor.username.first.upcase %></div>
                  <span class="info-value"><%= @supervisor.username %></span>
                </div>
              </div>
            <% end %>
          <% else %>
            <!-- Student Information -->
            <div class="info-item">
              <span class="info-label">Name</span>
              <div class="profile-container">
                <div class="profile-avatar"><%= @student.username.first.upcase %></div>
                <span class="info-value"><%= @student.username %></span>
              </div>
            </div>
            <div class="info-item">
              <span class="info-label">Student ID</span>
              <span class="info-value"><%= @student.student_id || '-' %></span>
            </div>
            <div class="info-item">
              <span class="info-label">Email</span>
              <span class="info-value"><%= @student.email_address %></span>
            </div>
            <div class="info-item">
              <span class="info-label">Project Status</span>
              <span class="info-value">
                <% status_display = @status || 'not_submitted' %>
                <span class="status-badge <%= status_display.downcase.gsub('_', '-') %>">
                  <div class="status-indicator <%= status_display.downcase.gsub('_', '-') %>"></div>
                  <span><%= status_display.humanize %></span>
                </span>
              </span>
            </div>
            <% if @supervisor.present? %>
              <div class="info-item">
                <span class="info-label">Supervisor</span>
                <div class="profile-container-lecturer">
                  <div class="profile-avatar"><%= @supervisor.username.first.upcase %></div>
                  <span class="info-value"><%= @supervisor.username %></span>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
        <br>
      </header>

      <!-- Current Project Section -->
      <% if @project.present? %>
        <section class="lecturer-topics", id="current-project">
          <header class="section-header">
            <h2 class="section-title">Current Project</h2>
          </header>
          <div class="lecturer-line"></div>
          <div class="topics-container">
            <div class="cards-container">
              <%= render partial: 'courses/project_card',
                        object: @project,
                        as: :project,
                        locals: { course: @course,
                        participant_id: @participant_type == 'group' ? @group.id : @student.id,
                        participant_type: @participant_type
                        } %>
            </div>
          </div>
        </section>
      <% else %>
        <section class="lecturer-topics">
          <header class="section-header">
            <h2 class="section-title">Current Project</h2>
          </header>
          <div class="lecturer-line"></div>
          <div class="topics-container">
            <div class="no-topics">
              <p>No Project Submitted</p>
            </div>
          </div>
        </section>
      <% end %>

      <footer class="lecturer-footer">
        <%= link_to "â† Back to Course", course_path(@course) %>
      </footer>
    </section>
  </div>
</main>
